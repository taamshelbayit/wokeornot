<% layout('layout') %>
<div class="movie-details">
  <div class="row">
    <div class="col-md-4">
      <% if(movie.posterPath) { %>
        <img src="https://image.tmdb.org/t/p/w500<%= movie.posterPath %>" class="img-fluid" alt="<%= movie.title %>">
      <% } %>
    </div>
    <div class="col-md-8">
      <h2><%= movie.title %></h2>
      <p><%= movie.description %></p>
      <p>Average Woke Rating: <%= movie.averageRating.toFixed(1) %>/10</p>
    </div>
  </div>
</div>

<hr>

<div class="review-form mt-4">
  <h3>Add Your Review</h3>
  <form action="/reviews/add/<%= movie._id %>" method="POST">
    <div class="form-group">
      <label>Rating (1-10)</label>
      <input type="number" name="rating" min="1" max="10" class="form-control" required>
    </div>
    <div class="form-group">
      <label>Review</label>
      <textarea name="content" class="form-control" required></textarea>
    </div>
    <div class="form-group">
      <label>Categories (comma separated, e.g., Transgender Themes, LGBT Representation, Race Swapping, Feminist Agenda, etc.)</label>
      <input type="text" name="categories" class="form-control">
    </div>
    <button type="submit" class="btn btn-success">Submit Review</button>
  </form>
</div>

<hr>

<div class="reviews mt-4">
  <h3>User Reviews</h3>
  <% movie.reviews.forEach(review => { %>
    <div class="card mb-3">
      <div class="card-body">
        <p><strong>Rating:</strong> <%= review.rating %>/10</p>
        <p><%= review.content %></p>
        <p><strong>Categories:</strong> <%= review.categories.join(', ') %></p>
      </div>
    </div>
  <% }) %>
</div>

<hr>

<div class="forum mt-4">
  <h3>Discussion Forum</h3>
  <form action="/forum/add/<%= movie._id %>" method="POST">
    <div class="form-group">
      <textarea name="content" class="form-control" placeholder="Join the discussion..." required></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Post Comment</button>
  </form>

  <% movie.forum.forEach(comment => { %>
    <div class="card mt-2">
      <div class="card-body">
        <p><%= comment.content %></p>
        <small>Posted on <%= comment.createdAt.toDateString() %></small>
      </div>
    </div>
  <% }) %>
</div>
